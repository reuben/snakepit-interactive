#!/bin/bash
set -xe

# Customize this file to your needs, any preparation you want all interactive jobs
# to share can go here.
apt-get install -y python3-venv git-lfs

pip3 install rmate # globally

git lfs install

# Avoid cloning inside /data as the LFS phase is super slow
pushd /tmp
    git clone https://github.com/mozilla/DeepSpeech.git
popd
mv /tmp/DeepSpeech .
cd DeepSpeech

python3 -m venv /tmp/venv
. /tmp/venv/bin/activate
pip install wheel
pip install -r <(grep -v tensorflow requirements.txt)
pip install tensorflow-gpu==1.14.0
pip install $(python util/taskcluster.py --decoder)
